<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tools &mdash; ochonetes 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ochonetes 1.0 documentation" href="index.html" />
    <link rel="prev" title="Portal" href="portal.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="portal.html" title="Portal"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ochonetes 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tools">
<h1>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-tool-set">
<h2>The tool set<a class="headerlink" href="#the-tool-set" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The <em>portal</em> application we run as a proxy embeds a whole bunch of tools. Those are all little standalone <a class="reference external" href="https://www.python.org/">Python</a>
scripts that the <em>portal</em> will <em>POpen()</em> from a temporary directory. They all support a <em>&#8211;help</em> switch which displays
detailed information, supported parameters and so on.</p>
<p>You can also use the <strong>help</strong> command to print out a complete list of tools.</p>
</div>
<div class="section" id="container-definitions">
<h3>Container definitions<a class="headerlink" href="#container-definitions" title="Permalink to this headline">¶</a></h3>
<p>In order to deploy our <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> clusters we need to feed enough information to <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> and deploy specific
constructs (<em>applications</em> in the present case). This is all done by the <strong>deploy</strong> tool in a fairly generic fashion.</p>
<p>Now we of course want to pass just enough data to quantify what we need to run, what ports to expose and so on. This
is done via a tiny <a class="reference external" href="http://yaml.org/">YAML</a> file I call a <em>container definition</em>. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>cluster:  zookeeper
image:    paugamo/marathon-ec2-zookeeper
ports:
    - 2181
    - 2888
    - 3888
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This <a class="reference external" href="http://yaml.org/">YAML</a> file is <strong>not</strong> related to the <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> API in any way. This is completely specific to <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a>.</p>
</div>
<p>This little snippet can be uploaded and passed to the <strong>deploy</strong> tool which will then turn it into a full-fledged
<em>application</em> call to the <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> API. Any required setting for <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> will be added in there as well transparently.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note I decided to split image building &amp; deployment as it turned out to be impractical to have the <em>portal</em>
to build/push images on its own. With the current model you are assumed to have images already built somewhere,
which is still fine.</p>
</div>
</div>
<div class="section" id="debug-logging">
<h3>Debug logging<a class="headerlink" href="#debug-logging" title="Permalink to this headline">¶</a></h3>
<p>You can always get access to your <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> internal log (located at <em>/var/log/ochopod.log</em>) for all your containers.
Simply use the <strong>log</strong> tool for that. Now the log level is by default set to <em>INFO</em> and above. You can force it to
<em>DEBUG</em> by switching the optional <em>debug</em> setting to true. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>cluster:  zookeeper
image:    paugamo/marathon-ec2-zookeeper
debug:    true
ports:
    - 2181
    - 2888
    - 3888
</pre></div>
</div>
<p>This can be helpful to troubleshoot problems at runtime. Beware, the <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> debug log is quite verbose.</p>
</div>
<div class="section" id="container-settings">
<h3>Container settings<a class="headerlink" href="#container-settings" title="Permalink to this headline">¶</a></h3>
<p>The optional <em>settings</em> block which can hold arbitrary nested data. This will be turned into a single serialized
JSON snippet and passed to the container as the <em>$pod</em> environment variable. Very handy to specify complex runtime
settings. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>settings:
    jvm-options:
      -Xms1g
      -Xmx2g
</pre></div>
</div>
<p>You also have the ability to override those settings when using the <strong>deploy</strong> tool. Simply use the <em>-o</em> command line
option and point to a local <a class="reference external" href="http://yaml.org/">YAML</a> file. This file simply maps arbitrary settings for a given fully qualified cluster
identifier. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>dev.web-server:
    debug: true
    jvm-options:
      -Xmx1g

prod.web-server:
    debug: false
    jvm-options:
      -Xmx4g
</pre></div>
</div>
<p>Any container from cluster <em>web-server</em> under namespace <em>dev</em> will thus see <em>debug</em> set to true in its <em>$pod</em> variable.</p>
</div>
<div class="section" id="port-mappings">
<h3>Port mappings<a class="headerlink" href="#port-mappings" title="Permalink to this headline">¶</a></h3>
<p>You can define the TCP ports you wish to expose via the lightweight <em>ports</em> array setting. Each port binding can be
either an integer (default case mapping this port to some random port on the underlying node), two integers (the first
one being the container port and the second the corresponding port on the host) or an integer followed by a * (same
as before except both ports are the same). This will be mapped to the syntax <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> expects. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>ports:
    - 3000
    - 5000 *
    - 9000 9001
</pre></div>
</div>
</div>
<div class="section" id="verbatim-settings">
<h3>Verbatim settings<a class="headerlink" href="#verbatim-settings" title="Permalink to this headline">¶</a></h3>
<p>You can customize your <em>container definition</em> even further by adding optional <em>verbatim</em> settings. Those will be
included as is when making the REST call to the <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> masters. This is especially useful for idiosyncrasies such
as the resource quotas. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>cluster:  zookeeper
image:    paugamo/k8s-ec2-zookeeper
settings:
verbatim:
    cpu: 1.0
    mem: 256

ports:
    - 2181
    - 2888
    - 3888
</pre></div>
</div>
</div>
<div class="section" id="your-clusters">
<h3>Your clusters<a class="headerlink" href="#your-clusters" title="Permalink to this headline">¶</a></h3>
<p>Once a <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> cluster is deployed you will get a new <em>application</em> (plus a certain number of <em>tasks</em>). Its
name will be assembled from the <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> cluster &amp; namespace plus a unique timestamp. You don&#8217;t have to worry about
how this is done, what the <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> API looks like and so on.</p>
<p>The <strong>deploy</strong> command allows you to spawn new containers by creating a new (uniquely named) <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> application.
These containers will form (or join) a cluster which depends on what _namespace_ you pick. You can optionally ask for
_cycling_ containers in which case any container previously running in the cluster will be phased out.</p>
<p>The <strong>kill</strong> command will gracefully phase containers out (e.g they will be asked to stop whatever they are doing and
go into idling). Any underlying <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> application whose containers are all dead will the be automatically
deleted.</p>
<p>You can inspect your clusters at runtime using for instance the <strong>grep</strong>, <strong>info</strong> or <strong>log</strong> commands.</p>
</div>
<div class="section" id="ci-integration">
<h3>CI integration<a class="headerlink" href="#ci-integration" title="Permalink to this headline">¶</a></h3>
<p>Some of the tools support a <em>-j</em> switch which will format their output to JSON. This can be used for instance to
integrate smoothly with a CI system such as <a class="reference external" href="https://jenkins-ci.org/">Jenkins</a> ! Please note the only thing you need to setup is the portal IP
address (e.g no tools to install locally).</p>
<p>The <strong>ping</strong> tool has been provided to allow direct interactions with the running containers. You can send arbitrary
<a class="reference external" href="http://yaml.org/">YAML</a> data (some commands or maybe some updated configuration settings) to whatever cluster(s). The <a class="reference external" href="https://github.com/autodesk-cloud/ochopod">Ochopod</a> script
running on those containers has the option to implement custom logic to react to that <a class="reference external" href="http://yaml.org/">YAML</a> data and respond back. This
is a great way to quickly add controlling logic driven for instance from a <a class="reference external" href="https://jenkins-ci.org/">Jenkins</a> slave.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/autodesk-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tools</a><ul>
<li><a class="reference internal" href="#the-tool-set">The tool set</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#container-definitions">Container definitions</a></li>
<li><a class="reference internal" href="#debug-logging">Debug logging</a></li>
<li><a class="reference internal" href="#container-settings">Container settings</a></li>
<li><a class="reference internal" href="#port-mappings">Port mappings</a></li>
<li><a class="reference internal" href="#verbatim-settings">Verbatim settings</a></li>
<li><a class="reference internal" href="#your-clusters">Your clusters</a></li>
<li><a class="reference internal" href="#ci-integration">CI integration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="portal.html" title="previous chapter">Portal</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2015, Autodesk.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>